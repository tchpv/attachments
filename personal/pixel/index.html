<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collaborative Pixel Art</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            padding: 20px;
        }

        h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        p {
            font-size: 1.2em;
            margin-bottom: 20px;
            text-align: center;
            max-width: 600px;
        }

        #controls {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #emailForm {
            margin-bottom: 20px;
        }

        #pixelContainer {
            display: grid;
            grid-template-columns: repeat(378, 2px); /* 20cm in pixels at 96dpi */
            width: 20cm;
            height: 10cm;
            pointer-events: none; /* Disable interaction by default */
        }

        .pixel {
            width: 2px;
            height: 2px;
            background-color: white;
            cursor: pointer;
        }

        input[type="color"] {
            margin-right: 10px;
        }

        input[type="email"] {
            padding: 5px;
            font-size: 16px;
            margin-right: 10px;
        }

        button {
            padding: 5px 10px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }

        #submitEmail {
            background-color: #008CBA;
        }
    </style>
</head>
<body>
    <h1>Collaborative Pixel Art</h1>
    <p>Welcome to the collaborative pixel art project! Submit your email to start creating your own pixel art. You can only modify squares that are either free or were last modified by you.</p>

    <div id="controls">
        <form id="emailForm">
            <input type="email" id="emailInput" placeholder="Enter your email" required>
            <button type="submit" id="submitEmail">Submit</button>
        </form>
        <input type="color" id="colorPicker" value="#ff0000" disabled>
    </div>

    <div id="pixelContainer"></div>

    <script>
        const emailForm = document.getElementById('emailForm');
        const emailInput = document.getElementById('emailInput');
        const colorPicker = document.getElementById('colorPicker');
        const pixelContainer = document.getElementById('pixelContainer');
        const numberOfColumns = 378; // 20cm in pixels at 96dpi
        const numberOfRows = 189; // 10cm in pixels at 96dpi
        const totalPixels = numberOfColumns * numberOfRows;

        let pixelData = JSON.parse(localStorage.getItem('pixelData')) || [];
        let currentUserEmail = '';

        // Function to create a new pixel
        function createPixel(index) {
            const pixel = document.createElement('div');
            pixel.classList.add('pixel');

            // Set the background color and owner from the saved data if it exists
            if (pixelData[index]) {
                pixel.style.backgroundColor = pixelData[index].color;
                pixel.dataset.owner = pixelData[index].owner;
            }

            pixel.addEventListener('click', () => {
                if (currentUserEmail && (pixel.style.backgroundColor === 'white' || pixel.dataset.owner === currentUserEmail)) {
                    const color = colorPicker.value;
                    pixel.style.backgroundColor = color;
                    pixel.dataset.owner = currentUserEmail;
                    pixelData[index] = { color: color, owner: currentUserEmail };
                    localStorage.setItem('pixelData', JSON.stringify(pixelData));
                }
            });

            return pixel;
        }

        // Create and display the pixels all at once for better performance
        const fragment = document.createDocumentFragment();
        for (let i = 0; i < totalPixels; i++) {
            fragment.appendChild(createPixel(i));
        }
        pixelContainer.appendChild(fragment);

        // Handle email submission
        emailForm.addEventListener('submit', (event) => {
            event.preventDefault();
            currentUserEmail = emailInput.value.trim();
            if (currentUserEmail) {
                colorPicker.disabled = false;
                pixelContainer.style.pointerEvents = 'auto'; // Enable interaction
                alert(`Welcome, ${currentUserEmail}! You can now start creating your pixel art.`);
            }
        });

    </script>
</body>
</html>
