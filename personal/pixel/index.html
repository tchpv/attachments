<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collaborative Pixel Art</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            padding: 20px;
        }

        h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        p {
            font-size: 1.2em;
            margin-bottom: 20px;
            text-align: center;
            max-width: 600px;
        }

        #controls {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #authForm {
            margin-bottom: 20px;
        }

        #pixelContainer {
            display: grid;
            grid-template-columns: repeat(378, 2px); /* 20cm in pixels at 96dpi */
            width: 20cm;
            height: 10cm;
            pointer-events: none; /* Disable interaction by default */
            overflow: hidden;
            transition: transform 0.3s ease-in-out;
        }

        .pixel {
            width: 2px;
            height: 2px;
            background-color: white;
            cursor: pointer;
        }

        input[type="color"] {
            margin-right: 10px;
        }

        input[type="text"], input[type="password"] {
            padding: 5px;
            font-size: 16px;
            margin-right: 10px;
        }

        button {
            padding: 5px 10px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 10px;
        }

        #loginButton {
            background-color: #008CBA;
        }

        #zoomInButton, #zoomOutButton {
            margin-top: 10px;
            background-color: #555;
        }
    </style>
</head>
<body>
    <h1>Collaborative Pixel Art</h1>
    <p>Welcome to the collaborative pixel art project! Sign up or log in to start creating your own pixel art. You can only modify squares that are either free or were last modified by you.</p>

    <div id="controls">
        <form id="authForm">
            <input type="text" id="usernameInput" placeholder="Username" required>
            <input type="password" id="passwordInput" placeholder="Password" required>
            <button type="button" id="signUpButton">Sign Up</button>
            <button type="button" id="loginButton">Log In</button>
        </form>
        <input type="color" id="colorPicker" value="#ff0000" disabled>
        <button type="button" id="zoomInButton">Zoom In</button>
        <button type="button" id="zoomOutButton">Zoom Out</button>
    </div>

    <div id="pixelContainer"></div>

    <script>
        const authForm = document.getElementById('authForm');
        const usernameInput = document.getElementById('usernameInput');
        const passwordInput = document.getElementById('passwordInput');
        const signUpButton = document.getElementById('signUpButton');
        const loginButton = document.getElementById('loginButton');
        const colorPicker = document.getElementById('colorPicker');
        const pixelContainer = document.getElementById('pixelContainer');
        const zoomInButton = document.getElementById('zoomInButton');
        const zoomOutButton = document.getElementById('zoomOutButton');
        const numberOfColumns = 378; // 20cm in pixels at 96dpi
        const numberOfRows = 189; // 10cm in pixels at 96dpi
        const totalPixels = numberOfColumns * numberOfRows;

        let users = JSON.parse(localStorage.getItem('users')) || {};
        let pixelData = JSON.parse(localStorage.getItem('pixelData')) || [];
        let currentUser = null;

        // Function to create a new pixel
        function createPixel(index) {
            const pixel = document.createElement('div');
            pixel.classList.add('pixel');

            // Set the background color and owner from the saved data if it exists
            if (pixelData[index]) {
                pixel.style.backgroundColor = pixelData[index].color;
                pixel.dataset.owner = pixelData[index].owner;
            }

            pixel.addEventListener('click', () => {
                if (currentUser && (pixel.style.backgroundColor === 'white' || pixel.dataset.owner === currentUser)) {
                    const color = colorPicker.value;
                    pixel.style.backgroundColor = color;
                    pixel.dataset.owner = currentUser;
                    pixelData[index] = { color: color, owner: currentUser };
                    localStorage.setItem('pixelData', JSON.stringify(pixelData));
                }
            });

            return pixel;
        }

        // Create and display the pixels all at once for better performance
        const fragment = document.createDocumentFragment();
        for (let i = 0; i < totalPixels; i++) {
            fragment.appendChild(createPixel(i));
        }
        pixelContainer.appendChild(fragment);

        // Handle sign-up
        signUpButton.addEventListener('click', () => {
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();
            if (username && password) {
                if (users[username]) {
                    alert('Username already exists! Please choose another.');
                } else {
                    users[username] = { password: password };
                    localStorage.setItem('users', JSON.stringify(users));
                    alert('Sign up successful! You can now log in.');
                }
            } else {
                alert('Please enter both a username and a password.');
            }
        });

        // Handle login
        loginButton.addEventListener('click', () => {
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();
            if (username && password) {
                if (users[username] && users[username].password === password) {
                    currentUser = username;
                    colorPicker.disabled = false;
                    pixelContainer.style.pointerEvents = 'auto'; // Enable interaction
                    alert(`Welcome, ${username}! You can now start creating your pixel art.`);
                } else {
                    alert('Invalid username or password.');
                }
            } else {
                alert('Please enter both a username and a password.');
            }
        });

        // Zoom in and out functionality
        let zoomLevel = 1;
        zoomInButton.addEventListener('click', () => {
            if (zoomLevel < 10) {
                zoomLevel += 0.5;
                pixelContainer.style.transform = `scale(${zoomLevel})`;
            }
        });

        zoomOutButton.addEventListener('click', () => {
            if (zoomLevel > 1) {
                zoomLevel -= 0.5;
                pixelContainer.style.transform = `scale(${zoomLevel})`;
            }
        });
    </script>
</body>
</html>
